var e=Object.defineProperty,r=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,a=(r,t,n)=>t in r?e(r,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[t]=n,s=(e,a)=>{var s={};for(var u in e)t.call(e,u)&&a.indexOf(u)<0&&(s[u]=e[u]);if(null!=e&&r)for(var u of r(e))a.indexOf(u)<0&&n.call(e,u)&&(s[u]=e[u]);return s};import{a as u,b as o,L as l,H as c,D as f,J as i,u as p,_ as m}from"./index-DsY_2V6a.js";import{r as d}from"./index-V6KHFFTR.js";function b(e,p,m){const b=u((e=>e.size)),g=u((e=>e.viewport)),y="number"==typeof e?e:b.width*g.dpr,v="number"==typeof p?p:b.height*g.dpr,h=("number"==typeof e?m:e)||{},{samples:w=0,depth:E}=h,x=s(h,["samples","depth"]),O=d.useMemo((()=>{const e=new o(y,v,((e,s)=>{for(var u in s||(s={}))t.call(s,u)&&a(e,u,s[u]);if(r)for(var u of r(s))n.call(s,u)&&a(e,u,s[u]);return e})({minFilter:l,magFilter:l,type:c},x));return E&&(e.depthTexture=new f(y,v,i)),e.samples=w,e}),[]);return d.useLayoutEffect((()=>{O.setSize(y,v),w&&(O.samples=w)}),[w,O,y,v]),d.useEffect((()=>()=>O.dispose()),[]),O}const g=d.forwardRef(((e,r)=>{var t=e,{envMap:n,resolution:a=256,frames:o=1/0,makeDefault:l,children:c}=t,f=s(t,["envMap","resolution","frames","makeDefault","children"]);const i=u((({set:e})=>e)),g=u((({camera:e})=>e)),y=u((({size:e})=>e)),v=d.useRef(null);d.useImperativeHandle(r,(()=>v.current),[]);const h=d.useRef(null),w=b(a);d.useLayoutEffect((()=>{f.manual||(v.current.aspect=y.width/y.height)}),[y,f]),d.useLayoutEffect((()=>{v.current.updateProjectionMatrix()}));let E=0,x=null;const O="function"==typeof c;return p((e=>{O&&(o===1/0||E<o)&&(h.current.visible=!1,e.gl.setRenderTarget(w),x=e.scene.background,n&&(e.scene.background=n),e.gl.render(e.scene,v.current),e.scene.background=x,e.gl.setRenderTarget(null),h.current.visible=!0,E++)})),d.useLayoutEffect((()=>{if(l){const e=g;return i((()=>({camera:v.current}))),()=>i((()=>({camera:e})))}}),[v,l,i]),d.createElement(d.Fragment,null,d.createElement("perspectiveCamera",m({ref:v},f),!O&&c),d.createElement("group",{ref:h},O&&c(w.texture)))}));export{g as P};
//# sourceMappingURL=PerspectiveCamera-PT3-WYbM.js.map
