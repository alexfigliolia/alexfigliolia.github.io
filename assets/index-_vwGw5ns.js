var t=Object.defineProperty,e=Object.defineProperties,n=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,i=(e,n,r)=>n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r,s=(t,e)=>{for(var n in e||(e={}))a.call(e,n)&&i(t,n,e[n]);if(r)for(var n of r(e))o.call(e,n)&&i(t,n,e[n]);return t},u=(t,r)=>e(t,n(r)),c=(t,e)=>{var n={};for(var i in t)a.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&r)for(var i of r(t))e.indexOf(i)<0&&o.call(t,i)&&(n[i]=t[i]);return n},l=(t,e,n)=>(i(t,"symbol"!=typeof e?e+"":e,n),n);import{r as p,j as h,u as m,F as f,A as d,C as y,O as _,S as M,R as v,G as w,W as E}from"./index-V6KHFFTR.js";import{L as A,O as g}from"./index-8y9kuNA2.js";import{V as I,o as x,h as b,Q as T,i as S,j as P,E as G,p as R,u as j,q as C,f as H,r as O,s as N,F as z,t as k,v as W,w as D,n as U,x as L}from"./index-DsY_2V6a.js";import{M as q,d as F}from"./MathUtils-DiN6UX3T.js";import{P as V}from"./PerspectiveCamera-PT3-WYbM.js";function B(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Q(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function $(t){return function(t){if(Array.isArray(t))return Q(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Q(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Q(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Z(t,e){return n=t-Math.floor(t/e)*e,r=0,a=e,Math.max(r,Math.min(a,n));var n,r,a}function J(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}new I,new I;var K=function t(e,n,r){var a=this;J(this,t),B(this,"dot2",(function(t,e){return a.x*t+a.y*e})),B(this,"dot3",(function(t,e,n){return a.x*t+a.y*e+a.z*n})),this.x=e,this.y=n,this.z=r},X=[new K(1,1,0),new K(-1,1,0),new K(1,-1,0),new K(-1,-1,0),new K(1,0,1),new K(-1,0,1),new K(1,0,-1),new K(-1,0,-1),new K(0,1,1),new K(0,-1,1),new K(0,1,-1),new K(0,-1,-1)],Y=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],tt=new Array(512),et=new Array(512);function nt(t){var e=function(t){if("number"==typeof t)t=Math.abs(t);else if("string"==typeof t){var e=t;t=0;for(var n=0;n<e.length;n++)t=(t+(n+1)*(e.charCodeAt(n)%96))%2147483647}return 0===t&&(t=311),t}(t);return function(){var t=48271*e%2147483647;return e=t,t/2147483647}}!function(t){t>0&&t<1&&(t*=65536),(t=Math.floor(t))<256&&(t|=t<<8);for(var e=0;e<256;e++){var n;n=1&e?Y[e]^255&t:Y[e]^t>>8&255,tt[e]=tt[e+256]=n,et[e]=et[e+256]=X[n%12]}}(0);new function t(e){var n=this;J(this,t),B(this,"seed",0),B(this,"init",(function(t){n.seed=t,n.value=nt(t)})),B(this,"value",nt(this.seed)),this.init(e)}(Math.random());var rt=function(t){return 1/(1+t+.48*t*t+.235*t*t*t)},at={in:function(t){return 1-Math.cos(t*Math.PI/2)},out:function(t){return Math.sin(t*Math.PI/2)},inOut:function(t){return-(Math.cos(Math.PI*t)-1)/2}},ot={in:function(t){return t*t*t},out:function(t){return 1-Math.pow(1-t,3)},inOut:function(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}},it={in:function(t){return t*t*t*t*t},out:function(t){return 1-Math.pow(1-t,5)},inOut:function(t){return t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2}},st={in:function(t){return 1-Math.sqrt(1-Math.pow(t,2))},out:function(t){return Math.sqrt(1-Math.pow(t-1,2))},inOut:function(t){return t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2}},ut={in:function(t){return 0===t?0:Math.pow(2,10*t-10)},out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},inOut:function(t){return 0===t?0:1===t?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2}};function ct(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.25,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.01,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:rt,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:.001,u="velocity_"+e;if(void 0===t.__damp&&(t.__damp={}),void 0===t.__damp[u]&&(t.__damp[u]=0),Math.abs(t[e]-n)<=s)return t[e]=n,!1;var c=2/(r=Math.max(1e-4,r)),l=i(c*a),p=t[e]-n,h=n,m=o*r;p=Math.min(Math.max(p,-m),m),n=t[e]-p;var f=(t.__damp[u]+c*p)*a;t.__damp[u]=(t.__damp[u]-c*f)*l;var d=n+(p+f)*l;return h-t[e]>0==d>h&&(d=h,t.__damp[u]=(d-h)/a),t[e]=d,!0}var lt=new b,pt=new T,ht=new T,mt=new S,ft=new b;function dt(t,e,n,r,a,o,i,s){return ct(t,e,t[e]+function(t,e){var n=Z(e-t,2*Math.PI);return n>Math.PI&&(n-=2*Math.PI),n}(t[e],n),r,a,o,i,s)}var yt,_t,Mt=new I;var vt,wt,Et,At=new b;function gt(t,e,n,r,a,o,i){return"number"==typeof e?At.setScalar(e):Array.isArray(e)?At.set(e[0],e[1],e[2]):At.copy(e),vt=ct(t,"x",At.x,n,r,a,o,i),wt=ct(t,"y",At.y,n,r,a,o,i),Et=ct(t,"z",At.z,n,r,a,o,i),vt||wt||Et}var It,xt,bt,Tt,St=new P;var Pt,Gt,Rt,jt=new G;var Ct,Ht,Ot,Nt=new x;var zt,kt,Wt,Dt,Ut=new T,Lt=new P,qt=new P,Ft=new P;function Vt(t,e,n,r,a,o,i){var s=t;Array.isArray(e)?Ut.set(e[0],e[1],e[2],e[3]):Ut.copy(e);var u=t.dot(Ut)>0?1:-1;return Ut.x*=u,Ut.y*=u,Ut.z*=u,Ut.w*=u,zt=ct(t,"x",Ut.x,n,r,a,o,i),kt=ct(t,"y",Ut.y,n,r,a,o,i),Wt=ct(t,"z",Ut.z,n,r,a,o,i),Dt=ct(t,"w",Ut.w,n,r,a,o,i),Lt.set(t.x,t.y,t.z,t.w).normalize(),qt.set(s.__damp.velocity_x,s.__damp.velocity_y,s.__damp.velocity_z,s.__damp.velocity_w),Ft.copy(Lt).multiplyScalar(qt.dot(Lt)/Lt.dot(Lt)),s.__damp.velocity_x-=Ft.x,s.__damp.velocity_y-=Ft.y,s.__damp.velocity_z-=Ft.z,s.__damp.velocity_w-=Ft.w,t.set(Lt.x,Lt.y,Lt.z,Lt.w),zt||kt||Wt||Dt}var Bt,Qt,$t,Zt=new R;var Jt,Kt,Xt,Yt=new S,te=new b,ee=new T,ne=new b;var re=Object.freeze({__proto__:null,rsqw:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/(2*Math.PI);return n/Math.atan(1/e)*Math.atan(Math.sin(2*Math.PI*t*r)/e)},exp:rt,linear:function(t){return t},sine:at,cubic:ot,quint:it,circ:st,quart:{in:function(t){return t*t*t*t},out:function(t){return 1- --t*t*t*t},inOut:function(t){return t<.5?8*t*t*t*t:1-8*--t*t*t*t}},expo:ut,damp:ct,dampLookAt:function(t,e,n,r,a,o,i){"number"==typeof e?lt.setScalar(e):Array.isArray(e)?lt.set(e[0],e[1],e[2]):lt.copy(e);var s,u=t.parent;t.updateWorldMatrix(!0,!1),ft.setFromMatrixPosition(t.matrixWorld),(s=t)&&s.isCamera||function(t){return t&&t.isLight}(t)?mt.lookAt(ft,lt,t.up):mt.lookAt(lt,ft,t.up),Vt(t.quaternion,ht.setFromRotationMatrix(mt),n,r,a,o,i),u&&(mt.extractRotation(u.matrixWorld),pt.setFromRotationMatrix(mt),Vt(t.quaternion,ht.copy(t.quaternion).premultiply(pt.invert()),n,r,a,o,i))},dampAngle:dt,damp2:function(t,e,n,r,a,o,i){return"number"==typeof e?Mt.setScalar(e):Array.isArray(e)?Mt.set(e[0],e[1]):Mt.copy(e),yt=ct(t,"x",Mt.x,n,r,a,o,i),_t=ct(t,"y",Mt.y,n,r,a,o,i),yt||_t},damp3:gt,damp4:function(t,e,n,r,a,o,i){return"number"==typeof e?St.setScalar(e):Array.isArray(e)?St.set(e[0],e[1],e[2],e[3]):St.copy(e),It=ct(t,"x",St.x,n,r,a,o,i),xt=ct(t,"y",St.y,n,r,a,o,i),bt=ct(t,"z",St.z,n,r,a,o,i),Tt=ct(t,"w",St.w,n,r,a,o,i),It||xt||bt||Tt},dampE:function(t,e,n,r,a,o,i){return Array.isArray(e)?jt.set(e[0],e[1],e[2],e[3]):jt.copy(e),Pt=dt(t,"x",jt.x,n,r,a,o,i),Gt=dt(t,"y",jt.y,n,r,a,o,i),Rt=dt(t,"z",jt.z,n,r,a,o,i),Pt||Gt||Rt},dampC:function(t,e,n,r,a,o,i){return e instanceof x?Nt.copy(e):Array.isArray(e)?Nt.setRGB(e[0],e[1],e[2]):Nt.set(e),Ct=ct(t,"r",Nt.r,n,r,a,o,i),Ht=ct(t,"g",Nt.g,n,r,a,o,i),Ot=ct(t,"b",Nt.b,n,r,a,o,i),Ct||Ht||Ot},dampQ:Vt,dampS:function(t,e,n,r,a,o,i){return Array.isArray(e)?Zt.set(e[0],e[1],e[2]):Zt.copy(e),Bt=ct(t,"radius",Zt.radius,n,r,a,o,i),Qt=dt(t,"phi",Zt.phi,n,r,a,o,i),$t=dt(t,"theta",Zt.theta,n,r,a,o,i),Bt||Qt||$t},dampM:function(t,e,n,r,a,o,i){var s=t;return void 0===s.__damp&&(s.__damp={position:new b,rotation:new T,scale:new b},t.decompose(s.__damp.position,s.__damp.rotation,s.__damp.scale)),Array.isArray(e)?Yt.set.apply(Yt,$(e)):Yt.copy(e),Yt.decompose(te,ee,ne),Jt=gt(s.__damp.position,te,n,r,a,o,i),Kt=Vt(s.__damp.rotation,ee,n,r,a,o,i),Xt=gt(s.__damp.scale,ne,n,r,a,o,i),t.compose(s.__damp.position,s.__damp.rotation,s.__damp.scale),Jt||Kt||Xt}});const ae=p.forwardRef(((t,e)=>{var n=t,{children:r,enabled:a=!0,speed:o=1,rotationIntensity:i=1,floatIntensity:s=1,floatingRange:u=[-.1,.1],autoInvalidate:l=!1}=n,h=c(n,["children","enabled","speed","rotationIntensity","floatIntensity","floatingRange","autoInvalidate"]);const m=p.useRef(null);p.useImperativeHandle(e,(()=>m.current),[]);const f=p.useRef(1e4*Math.random());return j((t=>{var e,n;if(!a||0===o)return;l&&t.invalidate();const r=f.current+t.clock.elapsedTime;m.current.rotation.x=Math.cos(r/4*o)/8*i,m.current.rotation.y=Math.sin(r/4*o)/8*i,m.current.rotation.z=Math.sin(r/4*o)/20*i;let c=Math.sin(r/4*o)/10;c=C.mapLinear(c,-.1,.1,null!==(e=null==u?void 0:u[0])&&void 0!==e?e:-.1,null!==(n=null==u?void 0:u[1])&&void 0!==n?n:.1),m.current.position.y=c*s,m.current.updateMatrix()})),p.createElement("group",h,p.createElement("group",{ref:m,matrixAutoUpdate:!1},r))})),oe=p.createContext({current:1,setCurrent:()=>{}}),ie=({children:t})=>{const[e,n]=p.useState(1),r=p.useMemo((()=>({current:e,setCurrent:n})),[e]);return h.jsx(oe,{value:r,children:t})},se=({pages:t})=>{const e=p.useMemo((()=>Array.from({length:t},((t,e)=>e)).slice(1)),[t]);let n=0;return h.jsx("div",{className:"magazine-controls",children:e.map((t=>h.jsx(ue,{page:t,number:++n},t)))})};function ue({page:t,number:e}){const{current:n,setCurrent:r}=p.use(oe),a=p.useCallback((()=>{r(t)}),[t,r]),o=m({active:t===n}),i=p.useMemo((()=>`Page ${e}`),[e]);return h.jsx("button",{className:o,onClick:a,"data-text":i,children:i})}const ce=class{static createSkinnedMesh(t,e){const n=this.createBones(),r=new k(n),a=this.createPageMaterials(t,e),o=new W(this.pageGeometry,a);return o.castShadow=!0,o.receiveShadow=!0,o.frustumCulled=!1,o.add(n[0]),o.bind(r),o}static createBones(){var t,e;const n=[];for(let r=0;r<this.PAGE_SEGMENTS;r++){const a=new D;a.position.x=0===r?0:this.SEGMENT_WIDTH*r,null==(e=null==(t=null==n?void 0:n[r-1])?void 0:t.attach)||e.call(t,a),n.push(a)}return n}static createPageMaterials(t,e){return[...this.pageMaterials,new H({color:this.WHITE,map:t,roughness:.1,emissive:this.EMISSIVE,emissiveIntensity:0}),new H({color:this.WHITE,map:e,roughness:.1,emissive:this.EMISSIVE,emissiveIntensity:0})]}};l(ce,"PAGE_WIDTH",1.28),l(ce,"PAGE_HEIGHT",1.71),l(ce,"PAGE_DEPTH",.003),l(ce,"PAGE_SEGMENTS",30),l(ce,"TURN_EASE_FACTOR",.5),l(ce,"FOLD_EASE_FACTOR",.3),l(ce,"WHITE",new x("#fff")),l(ce,"EMISSIVE",new x("orange")),l(ce,"INSIDE_CURVE_STRENGTH",.18),l(ce,"OUTSITE_CURVE_STRENGTH",.05),l(ce,"TURNING_CURVE_STRENGTH",.09),l(ce,"WHITE_MATERIAL",new H({color:ce.WHITE})),l(ce,"SEGMENT_WIDTH",ce.PAGE_WIDTH/ce.PAGE_SEGMENTS),l(ce,"pageGeometry",new O(ce.PAGE_WIDTH,ce.PAGE_HEIGHT,ce.PAGE_DEPTH,ce.PAGE_SEGMENTS,2)),l(ce,"pageMaterials",[ce.WHITE_MATERIAL.clone(),new H({color:"#111"}),ce.WHITE_MATERIAL.clone(),ce.WHITE_MATERIAL.clone()]),(()=>{ce.pageGeometry.translate(ce.PAGE_WIDTH/2,0,0);const{position:t}=ce.pageGeometry.attributes,e=new b,n=[],r=[],{count:a}=t;for(let o=0;o<a;o++){e.fromBufferAttribute(t,o);const{x:a}=e,i=Math.max(0,Math.floor(a/ce.SEGMENT_WIDTH)),s=a%ce.SEGMENT_WIDTH/ce.SEGMENT_WIDTH;n.push(i,i+1,0,0),r.push(1-s,s,0,0)}ce.pageGeometry.setAttribute("skinIndex",new N(n,4)),ce.pageGeometry.setAttribute("skinWeight",new z(r,4))})();let le=ce;const pe=t=>{var e=t,{front:n,back:r,index:a,opened:o,current:i,bookClosed:l}=e,m=c(e,["front","back","index","opened","current","bookClosed"]);const f=p.useRef(0),d=p.useRef(o),y=p.useRef(null),_=p.useRef(null),{setCurrent:M}=p.use(oe),[v,w]=p.useState(!1);!function(t,e="pointer",n="auto",r=document.body){p.useEffect((()=>{if(t)return r.style.cursor=e,()=>{r.style.cursor=n}}),[t])}(v);const[E,A]=U([n,r],(t=>{t.forEach((t=>{t.colorSpace=L}))})),g=p.useMemo((()=>le.createSkinnedMesh(E,A)),[E,A]);j(((t,e)=>{if(!_.current||!y.current)return;const{material:n}=_.current;if(Array.isArray(n)&&n[4]){const t=v?.22:0;n[4].emissiveIntensity=t,n[5].emissiveIntensity=q.lerp(n[4].emissiveIntensity,t,.1)}d.current!==o&&(f.current=Date.now(),d.current=o);const r=Math.sin(Math.min(400,Date.now()-f.current)/400*Math.PI),i=Math.PI/2;let s=o?-i:i;l||(s+=F(.8*a));const u=_.current.skeleton.bones,{length:c}=u;for(let a=0;a<c;a++){const t=0===a?y.current:u[a],n=a<8?Math.sin(.2*a+.25):0,o=a>=8?Math.cos(.3*a+.09):0,i=Math.sin(a*Math.PI*(1/c))*r;let p=F(2*Math.sign(s)),h=0;l?0===a&&(p=0,h=s):h=le.INSIDE_CURVE_STRENGTH*n*s-le.OUTSITE_CURVE_STRENGTH*o*s+le.TURNING_CURVE_STRENGTH*i*s;const m=a>8?Math.sin(a*Math.PI*(1/c)-.5)*r:0;re.dampAngle(t.rotation,"y",h,le.TURN_EASE_FACTOR,e),re.dampAngle(t.rotation,"x",p*m,le.FOLD_EASE_FACTOR,e)}}));const I=p.useMemo((()=>-a*le.PAGE_DEPTH+i*le.PAGE_DEPTH),[a,i]),x=p.useCallback((t=>{t.stopPropagation(),w(!0)}),[]),b=p.useCallback((t=>{t.stopPropagation(),w(!1)}),[]),T=p.useCallback((t=>{t.stopPropagation(),M(o?a:a+1),w(!1)}),[o,M,a]);return h.jsx("group",u(s({ref:y},m),{onClick:T,onPointerEnter:x,onPointerLeave:b,children:h.jsx("primitive",{ref:_,object:g,"position-z":I})}))},he=({images:t})=>{const{current:e}=p.use(oe),[n,r]=p.useState(e),a=p.useMemo((()=>t.length),[t.length]),o=p.useRef(null),i=p.useCallback((()=>{r((t=>e===t?t:(o.current=setTimeout((()=>{i()}),Math.abs(e-t)>2?50:150),e>t?t+1:t-1)))}),[e]);return p.useEffect((()=>(i(),()=>{o.current&&clearTimeout(o.current)})),[e,i]),h.jsx("group",{"rotation-y":-Math.PI/2,receiveShadow:!0,children:t.map(((t,e)=>h.jsx(pe,u(s({},t),{index:e,current:n,opened:n>e,bookClosed:0===n||n===a}),e)))})},me=function(t){const e=[],{length:n}=t;for(let r=0;r<n;r+=2)e.push({front:t[r%n],back:t[(r+1)%n]});return e}([d,d,y,_,M,v,w,E,E]),fe=t=>h.jsx(ie,{children:h.jsxs(f,{className:"magazine-scene",children:[h.jsxs(A,{children:[h.jsx(ae,{children:h.jsx(he,{images:me})}),h.jsx(g,{enableZoom:!1,minAzimuthAngle:-Math.PI/4,maxAzimuthAngle:Math.PI/4,minPolarAngle:Math.PI/6,maxPolarAngle:Math.PI-Math.PI/6}),h.jsx("ambientLight",{castShadow:!0,intensity:2.5}),h.jsx(V,{makeDefault:!0,fov:30,zoom:2,position:[0,-8,8]}),h.jsx("spotLight",{castShadow:!0,color:[1,1,1],intensity:1.5,angle:.6,decay:0,penumbra:.1,position:[5,5,0],"shadow-bias":-1e-4})]}),h.jsx(se,{pages:me.length})]})});export{fe as MagazineScene};
//# sourceMappingURL=index-_vwGw5ns.js.map
