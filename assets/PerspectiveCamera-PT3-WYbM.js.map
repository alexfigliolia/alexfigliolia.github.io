{"version":3,"file":"PerspectiveCamera-PT3-WYbM.js","sources":["../../node_modules/@react-three/drei/core/Fbo.js","../../node_modules/@react-three/drei/core/PerspectiveCamera.js"],"sourcesContent":["import * as React from 'react';\nimport * as THREE from 'three';\nimport { useThree } from '@react-three/fiber';\n\n// ðŸ‘‡ uncomment when TS version supports function overloads\n// export function useFBO(settings?: FBOSettings)\nfunction useFBO(/** Width in pixels, or settings (will render fullscreen by default) */\nwidth, /** Height in pixels */\nheight, /**Settings */\nsettings) {\n  const size = useThree(state => state.size);\n  const viewport = useThree(state => state.viewport);\n  const _width = typeof width === 'number' ? width : size.width * viewport.dpr;\n  const _height = typeof height === 'number' ? height : size.height * viewport.dpr;\n  const _settings = (typeof width === 'number' ? settings : width) || {};\n  const {\n    samples = 0,\n    depth,\n    ...targetSettings\n  } = _settings;\n  const target = React.useMemo(() => {\n    const target = new THREE.WebGLRenderTarget(_width, _height, {\n      minFilter: THREE.LinearFilter,\n      magFilter: THREE.LinearFilter,\n      type: THREE.HalfFloatType,\n      ...targetSettings\n    });\n    if (depth) {\n      target.depthTexture = new THREE.DepthTexture(_width, _height, THREE.FloatType);\n    }\n    target.samples = samples;\n    return target;\n  }, []);\n  React.useLayoutEffect(() => {\n    target.setSize(_width, _height);\n    if (samples) target.samples = samples;\n  }, [samples, target, _width, _height]);\n  React.useEffect(() => {\n    return () => target.dispose();\n  }, []);\n  return target;\n}\nconst Fbo = ({\n  children,\n  width,\n  height,\n  ...settings\n}) => {\n  const target = useFBO(width, height, settings);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, children == null ? void 0 : children(target));\n};\n\nexport { Fbo, useFBO };\n","import _extends from '@babel/runtime/helpers/esm/extends';\nimport * as React from 'react';\nimport { useThree, useFrame } from '@react-three/fiber';\nimport { useFBO } from './Fbo.js';\n\nconst isFunction = node => typeof node === 'function';\nconst PerspectiveCamera = /* @__PURE__ */React.forwardRef(({\n  envMap,\n  resolution = 256,\n  frames = Infinity,\n  makeDefault,\n  children,\n  ...props\n}, ref) => {\n  const set = useThree(({\n    set\n  }) => set);\n  const camera = useThree(({\n    camera\n  }) => camera);\n  const size = useThree(({\n    size\n  }) => size);\n  const cameraRef = React.useRef(null);\n  React.useImperativeHandle(ref, () => cameraRef.current, []);\n  const groupRef = React.useRef(null);\n  const fbo = useFBO(resolution);\n  React.useLayoutEffect(() => {\n    if (!props.manual) {\n      cameraRef.current.aspect = size.width / size.height;\n    }\n  }, [size, props]);\n  React.useLayoutEffect(() => {\n    cameraRef.current.updateProjectionMatrix();\n  });\n  let count = 0;\n  let oldEnvMap = null;\n  const functional = isFunction(children);\n  useFrame(state => {\n    if (functional && (frames === Infinity || count < frames)) {\n      groupRef.current.visible = false;\n      state.gl.setRenderTarget(fbo);\n      oldEnvMap = state.scene.background;\n      if (envMap) state.scene.background = envMap;\n      state.gl.render(state.scene, cameraRef.current);\n      state.scene.background = oldEnvMap;\n      state.gl.setRenderTarget(null);\n      groupRef.current.visible = true;\n      count++;\n    }\n  });\n  React.useLayoutEffect(() => {\n    if (makeDefault) {\n      const oldCam = camera;\n      set(() => ({\n        camera: cameraRef.current\n      }));\n      return () => set(() => ({\n        camera: oldCam\n      }));\n    }\n    // The camera should not be part of the dependency list because this components camera is a stable reference\n    // that must exchange the default, and clean up after itself on unmount.\n  }, [cameraRef, makeDefault, set]);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"perspectiveCamera\", _extends({\n    ref: cameraRef\n  }, props), !functional && children), /*#__PURE__*/React.createElement(\"group\", {\n    ref: groupRef\n  }, functional && children(fbo.texture)));\n});\n\nexport { PerspectiveCamera };\n"],"names":["useFBO","width","height","settings","size","useThree","state","viewport","_width","dpr","_height","_a","samples","depth","targetSettings","__objRest","target","React.useMemo","THREE.WebGLRenderTarget","__spreadValues","minFilter","THREE.LinearFilter","magFilter","type","THREE.HalfFloatType","depthTexture","THREE.DepthTexture","THREE.FloatType","React.useLayoutEffect","setSize","React.useEffect","dispose","PerspectiveCamera","React.forwardRef","forwardRef","ref","_b","envMap","resolution","frames","Infinity","makeDefault","children","props","set","camera","cameraRef","React.useRef","React.useImperativeHandle","current","groupRef","fbo","manual","aspect","updateProjectionMatrix","count","oldEnvMap","functional","React.createElement","useFrame","visible","gl","setRenderTarget","scene","background","render","oldCam","React.Fragment","_extends","reactExports","createElement","texture"],"mappings":"wfAMA,SAASA,EACTC,EACAC,EACAC,GACE,MAAMC,EAAOC,GAAkBC,GAAAA,EAAMF,OAC/BG,EAAWF,GAAkBC,GAAAA,EAAMC,WACnCC,EAA0B,iBAAVP,EAAqBA,EAAQG,EAAKH,MAAQM,EAASE,IACnEC,EAA4B,iBAAXR,EAAsBA,EAASE,EAAKF,OAASK,EAASE,IAMzEE,GALgC,iBAAVV,EAAqBE,EAAWF,IAAU,IAElEW,QAAUA,EAAA,EAAAC,MACVA,GAEEF,EADCG,EAAAC,EACDJ,EADC,CAFH,UACA,UAGIK,EAASC,EAAAA,SAAc,KAC3B,MAAMD,EAAS,IAAIE,EAAwBV,EAAQE,qHAASS,CAAA,CAC1DC,UAAWC,EACXC,UAAWD,EACXE,KAAMC,GACHV,IAMEE,OAJHH,IACFG,EAAOS,aAAe,IAAIC,EAAmBlB,EAAQE,EAASiB,IAEhEX,EAAOJ,QAAUA,EACVI,CAAAA,GACN,IAQI,OAPPY,EAAAA,iBAAsB,KACbZ,EAAAa,QAAQrB,EAAQE,GACnBE,IAASI,EAAOJ,QAAUA,EAAA,GAC7B,CAACA,EAASI,EAAQR,EAAQE,IAC7BoB,EAAAA,WAAgB,IACP,IAAMd,EAAOe,WACnB,IACIf,CACT,CCpCA,MACMgB,EAAmCC,EAAgBC,YAAC,CAACvB,EAOxDwB,KAND,IAAAC,EAAAzB,GAAA0B,OAAAA,EAAAC,WACAA,EAAa,IAAAC,OACbA,EAASC,IAAAC,YACTA,EAAAC,SACAA,GALyDN,EAMtDO,EAAA5B,EANsDqB,EAMtD,CALH,SACA,aACA,SACA,cACA,aAGM,MAAAQ,EAAMvC,GAAS,EACnBuC,IAAAA,KACIA,IACAC,EAASxC,GAAS,EACtBwC,OAAAA,KACIA,IACAzC,EAAOC,GAAS,EACpBD,KAAAA,KACIA,IACA0C,EAAYC,SAAa,MAC/BC,EAAAA,oBAA0Bb,GAAK,IAAMW,EAAUG,SAAS,IAClD,MAAAC,EAAWH,SAAa,MACxBI,EAAMnD,EAAOsC,GACnBV,EAAAA,iBAAsB,KACfe,EAAMS,SACTN,EAAUG,QAAQI,OAASjD,EAAKH,MAAQG,EAAKF,OAC9C,GACA,CAACE,EAAMuC,IACVf,EAAAA,iBAAsB,KACpBkB,EAAUG,QAAQK,4BAEpB,IAAIC,EAAQ,EACRC,EAAY,KACV,MAAAC,EAhCmC,mBAgCXf,EA2BVgB,OA1BpBC,GAAkBrD,IACZmD,IAAelB,IAAWC,KAAYe,EAAQhB,KAChDW,EAASD,QAAQW,SAAU,EACrBtD,EAAAuD,GAAGC,gBAAgBX,GACzBK,EAAYlD,EAAMyD,MAAMC,WACpB3B,IAAQ/B,EAAMyD,MAAMC,WAAa3B,GACrC/B,EAAMuD,GAAGI,OAAO3D,EAAMyD,MAAOjB,EAAUG,SACvC3C,EAAMyD,MAAMC,WAAaR,EACnBlD,EAAAuD,GAAGC,gBAAgB,MACzBZ,EAASD,QAAQW,SAAU,EAC3BL,IACD,IAEH3B,EAAAA,iBAAsB,KACpB,GAAIa,EAAa,CACf,MAAMyB,EAASrB,EAIR,OAHPD,GAAI,KAAO,CACTC,OAAQC,EAAUG,YAEb,IAAML,GAAI,KAAO,CACtBC,OAAQqB,KAEX,IAGA,CAACpB,EAAWL,EAAaG,IACRc,EAAAA,cAAoBS,EAAAA,SAAgB,KAAmBT,EAAAA,cAAoB,oBAAqBU,EAAS,CAC3HjC,IAAKW,GACJH,IAASc,GAAcf,GAA2C2B,EAAAC,cAAC,QAAS,CAC7EnC,IAAKe,GACJO,GAAcf,EAASS,EAAIoB,UAAS","x_google_ignoreList":[0,1]}