var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,o=(t,s,r)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r,i=(e,t)=>{for(var s in t||(t={}))n.call(t,s)&&o(e,s,t[s]);if(r)for(var s of r(t))a.call(t,s)&&o(e,s,t[s]);return e},c=(e,r)=>t(e,s(r)),l=(e,t,s)=>(o(e,"symbol"!=typeof t?t+"":t,s),s);import{r as u,j as E,b as h}from"./threeFiber-wgP-k_4X.js";import{u as m,F as p,A as T,C as I,O as f,S as M,R as d,G as b,W as g}from"./index-zVe65wBv.js";import{L as S}from"./index-9w1YpGEH.js";import{b as A,a as P,e as _,F as G,O as x,P as j}from"./threeDrei-TbYxsnpq.js";import{d as H,X as R,b0 as y,h as C,b1 as v,b2 as N,aJ as w,aD as D,aL as O,b as k}from"./three-71H3Suoo.js";import{M as W,d as L}from"./MathUtils-DiN6UX3T.js";import"./threeStdLib-Ui_sxDIS.js";import"./useLabsLoader-ysXV7W1A.js";const U=u.createContext({current:1,setCurrent:()=>{}}),F=({children:e})=>{const[t,s]=u.useState(1),r=u.useMemo((()=>({current:t,setCurrent:s})),[t]);return E.jsx(U,{value:r,children:e})},V=({pages:e})=>{const t=u.useMemo((()=>Array.from({length:e},((e,t)=>t)).slice(1)),[e]);let s=0;return E.jsx("div",{className:"magazine-controls",children:t.map((e=>E.jsx(z,{page:e,number:++s},e)))})};function z({page:e,number:t}){const{current:s,setCurrent:r}=u.use(U),n=u.useCallback((()=>{r(e)}),[e,r]),a=m({active:e===s}),o=u.useMemo((()=>`Page ${t}`),[t]);return E.jsx("button",{className:a,onClick:n,"data-text":o,children:o})}const B=class{static createSkinnedMesh(e,t){const s=this.createBones(),r=new w(s),n=this.createPageMaterials(e,t),a=new D(this.pageGeometry,n);return a.castShadow=!0,a.receiveShadow=!0,a.frustumCulled=!1,a.add(s[0]),a.bind(r),a}static createBones(){var e,t;const s=[];for(let r=0;r<this.PAGE_SEGMENTS;r++){const n=new O;n.position.x=0===r?0:this.SEGMENT_WIDTH*r,null==(t=null==(e=null==s?void 0:s[r-1])?void 0:e.attach)||t.call(e,n),s.push(n)}return s}static createPageMaterials(e,t){return[...this.pageMaterials,new R({color:this.WHITE,map:e,roughness:.1,emissive:this.EMISSIVE,emissiveIntensity:0}),new R({color:this.WHITE,map:t,roughness:.1,emissive:this.EMISSIVE,emissiveIntensity:0})]}};l(B,"PAGE_WIDTH",1.28),l(B,"PAGE_HEIGHT",1.71),l(B,"PAGE_DEPTH",.003),l(B,"PAGE_SEGMENTS",30),l(B,"TURN_EASE_FACTOR",.5),l(B,"FOLD_EASE_FACTOR",.3),l(B,"WHITE",new H("#fff")),l(B,"EMISSIVE",new H("orange")),l(B,"INSIDE_CURVE_STRENGTH",.18),l(B,"OUTSITE_CURVE_STRENGTH",.05),l(B,"TURNING_CURVE_STRENGTH",.09),l(B,"WHITE_MATERIAL",new R({color:B.WHITE})),l(B,"SEGMENT_WIDTH",B.PAGE_WIDTH/B.PAGE_SEGMENTS),l(B,"pageGeometry",new y(B.PAGE_WIDTH,B.PAGE_HEIGHT,B.PAGE_DEPTH,B.PAGE_SEGMENTS,2)),l(B,"pageMaterials",[B.WHITE_MATERIAL.clone(),new R({color:"#111"}),B.WHITE_MATERIAL.clone(),B.WHITE_MATERIAL.clone()]),(()=>{B.pageGeometry.translate(B.PAGE_WIDTH/2,0,0);const{position:e}=B.pageGeometry.attributes,t=new C,s=[],r=[],{count:n}=e;for(let a=0;a<n;a++){t.fromBufferAttribute(e,a);const{x:n}=t,o=Math.max(0,Math.floor(n/B.SEGMENT_WIDTH)),i=n%B.SEGMENT_WIDTH/B.SEGMENT_WIDTH;s.push(o,o+1,0,0),r.push(1-i,i,0,0)}B.pageGeometry.setAttribute("skinIndex",new v(s,4)),B.pageGeometry.setAttribute("skinWeight",new N(r,4))})();let J=B;const X=e=>{var t=e,{front:s,back:o,index:l,opened:m,current:p,bookClosed:T}=t,I=((e,t)=>{var s={};for(var o in e)n.call(e,o)&&t.indexOf(o)<0&&(s[o]=e[o]);if(null!=e&&r)for(var o of r(e))t.indexOf(o)<0&&a.call(e,o)&&(s[o]=e[o]);return s})(t,["front","back","index","opened","current","bookClosed"]);const f=u.useRef(0),M=u.useRef(m),d=u.useRef(null),b=u.useRef(null),{setCurrent:g}=u.use(U),[S,G]=u.useState(!1);A(S);const[x,j]=P([s,o],(e=>{e.forEach((e=>{e.colorSpace=k}))})),H=u.useMemo((()=>J.createSkinnedMesh(x,j)),[x,j]);h(((e,t)=>{if(!b.current||!d.current)return;const{material:s}=b.current;if(Array.isArray(s)&&s[4]){const e=S?.22:0;s[4].emissiveIntensity=e,s[5].emissiveIntensity=W.lerp(s[4].emissiveIntensity,e,.1)}M.current!==m&&(f.current=Date.now(),M.current=m);const r=Math.sin(Math.min(400,Date.now()-f.current)/400*Math.PI),n=Math.PI/2;let a=m?-n:n;T||(a+=L(.8*l));const o=b.current.skeleton.bones,{length:i}=o;for(let c=0;c<i;c++){const e=0===c?d.current:o[c],s=c<8?Math.sin(.2*c+.25):0,n=c>=8?Math.cos(.3*c+.09):0,l=Math.sin(c*Math.PI*(1/i))*r;let u=L(2*Math.sign(a)),E=0;T?0===c&&(u=0,E=a):E=J.INSIDE_CURVE_STRENGTH*s*a-J.OUTSITE_CURVE_STRENGTH*n*a+J.TURNING_CURVE_STRENGTH*l*a;const h=c>8?Math.sin(c*Math.PI*(1/i)-.5)*r:0;_.dampAngle(e.rotation,"y",E,J.TURN_EASE_FACTOR,t),_.dampAngle(e.rotation,"x",u*h,J.FOLD_EASE_FACTOR,t)}}));const R=u.useMemo((()=>-l*J.PAGE_DEPTH+p*J.PAGE_DEPTH),[l,p]),y=u.useCallback((e=>{e.stopPropagation(),G(!0)}),[]),C=u.useCallback((e=>{e.stopPropagation(),G(!1)}),[]),v=u.useCallback((e=>{e.stopPropagation(),g(m?l:l+1),G(!1)}),[m,g,l]);return E.jsx("group",c(i({ref:d},I),{onClick:v,onPointerEnter:y,onPointerLeave:C,children:E.jsx("primitive",{ref:b,object:H,"position-z":R})}))},Z=({images:e})=>{const{current:t}=u.use(U),[s,r]=u.useState(t),n=u.useMemo((()=>e.length),[e.length]),a=u.useRef(null),o=u.useCallback((()=>{r((e=>t===e?e:(a.current=setTimeout((()=>{o()}),Math.abs(t-e)>2?50:150),t>e?e+1:e-1)))}),[t]);return u.useEffect((()=>(o(),()=>{a.current&&clearTimeout(a.current)})),[t,o]),E.jsx("group",{"rotation-y":-Math.PI/2,receiveShadow:!0,children:e.map(((e,t)=>E.jsx(X,c(i({},e),{index:t,current:s,opened:s>t,bookClosed:0===s||s===n}),t)))})},$=function(e){const t=[],{length:s}=e;for(let r=0;r<s;r+=2)t.push({front:e[r%s],back:e[(r+1)%s]});return t}([T,T,I,f,M,d,b,g,g]),q=e=>E.jsx(F,{children:E.jsxs(p,{className:"magazine-scene",children:[E.jsxs(S,{children:[E.jsx(G,{children:E.jsx(Z,{images:$})}),E.jsx(x,{enableZoom:!1,minAzimuthAngle:-Math.PI/4,maxAzimuthAngle:Math.PI/4,minPolarAngle:Math.PI/6,maxPolarAngle:Math.PI-Math.PI/6}),E.jsx("ambientLight",{castShadow:!0,intensity:2.5}),E.jsx(j,{makeDefault:!0,fov:30,zoom:2,position:[0,-8,8]}),E.jsx("spotLight",{castShadow:!0,color:[1,1,1],intensity:1.5,angle:.6,decay:0,penumbra:.1,position:[5,5,0],"shadow-bias":-1e-4})]}),E.jsx(V,{pages:$.length})]})});export{q as MagazineScene};
//# sourceMappingURL=index-5ncOjcVo.js.map
