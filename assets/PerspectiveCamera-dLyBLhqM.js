var e=Object.defineProperty,r=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,n=(r,t,a)=>t in r?e(r,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[t]=a,s=(e,n)=>{var s={};for(var u in e)t.call(e,u)&&n.indexOf(u)<0&&(s[u]=e[u]);if(null!=e&&r)for(var u of r(e))n.indexOf(u)<0&&a.call(e,u)&&(s[u]=e[u]);return s};import{a as u,b as o,L as l,H as c,D as f,J as i,u as p,_ as m}from"./useLabsLoader-Ips9P70R.js";import{r as d}from"./index-BW91fhZy.js";function b(e,p,m){const b=u((e=>e.size)),g=u((e=>e.viewport)),y="number"==typeof e?e:b.width*g.dpr,v="number"==typeof p?p:b.height*g.dpr,h=("number"==typeof e?m:e)||{},{samples:w=0,depth:E}=h,O=s(h,["samples","depth"]),j=d.useMemo((()=>{const e=new o(y,v,((e,s)=>{for(var u in s||(s={}))t.call(s,u)&&n(e,u,s[u]);if(r)for(var u of r(s))a.call(s,u)&&n(e,u,s[u]);return e})({minFilter:l,magFilter:l,type:c},O));return E&&(e.depthTexture=new f(y,v,i)),e.samples=w,e}),[]);return d.useLayoutEffect((()=>{j.setSize(y,v),w&&(j.samples=w)}),[w,j,y,v]),d.useEffect((()=>()=>j.dispose()),[]),j}const g=d.forwardRef(((e,r)=>{var t=e,{envMap:a,resolution:n=256,frames:o=1/0,makeDefault:l,children:c}=t,f=s(t,["envMap","resolution","frames","makeDefault","children"]);const i=u((({set:e})=>e)),g=u((({camera:e})=>e)),y=u((({size:e})=>e)),v=d.useRef(null);d.useImperativeHandle(r,(()=>v.current),[]);const h=d.useRef(null),w=b(n);d.useLayoutEffect((()=>{f.manual||(v.current.aspect=y.width/y.height)}),[y,f]),d.useLayoutEffect((()=>{v.current.updateProjectionMatrix()}));let E=0,O=null;const j="function"==typeof c;return p((e=>{j&&(o===1/0||E<o)&&(h.current.visible=!1,e.gl.setRenderTarget(w),O=e.scene.background,a&&(e.scene.background=a),e.gl.render(e.scene,v.current),e.scene.background=O,e.gl.setRenderTarget(null),h.current.visible=!0,E++)})),d.useLayoutEffect((()=>{if(l){const e=g;return i((()=>({camera:v.current}))),()=>i((()=>({camera:e})))}}),[v,l,i]),d.createElement(d.Fragment,null,d.createElement("perspectiveCamera",m({ref:v},f),!j&&c),d.createElement("group",{ref:h},j&&c(w.texture)))}));export{g as P};
//# sourceMappingURL=PerspectiveCamera-dLyBLhqM.js.map
